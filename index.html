<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SNDP Loan Portal — Welcome</title>
  <link rel="stylesheet" href="styles.css"/>
  <meta name="color-scheme" content="dark light"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
</head>
<body class="landing">
  <div class="landing-hero">
    <div class="hero-overlay">
      <header class="header">
        <div>
          <div class="title">SNDP Loan Portal</div>
          <div class="sub">Community savings &amp; credit unions inspired by Sree Narayana Guru</div>
        </div>
        <nav class="nav">
          <a href="README.html">Implementation Guide</a>
          <a href="#promptCard">AI Data Prompt</a>
        </nav>
      </header>
      <div class="hero-content">
        <h1>Community lending inspired by Guru Devan.</h1>
        <p>SNDP Yogam began in 1903 at Aruvippuram under the guidance of Sree Narayana Guru, championing cooperative welfare across Kerala. Explore how a member and a branch manager experience the same dataset with tailored dashboards.</p>
        <div class="pill-list">
          <span class="pill">Founded in 1903 at Aruvippuram, Kerala</span>
          <span class="pill">Headquarters in Kollam, Kerala</span>
          <span class="pill">Motto: “One caste, one religion, one God for humankind”</span>
        </div>
      </div>
    </div>
  </div>

  <main class="container landing-content">
    <section class="grid two login-panels">
      <form id="publicLoginForm" class="card glass login-card">
        <h3>Member Login</h3>
        <p class="small">Members view their personal profile, upload receipts, and monitor their loan ledger.</p>
        <label>Username
          <input class="input" name="username" id="memberUsername" autocomplete="username" required/>
        </label>
        <label>Password
          <input class="input" name="password" type="password" autocomplete="current-password" required/>
        </label>
        <div class="form-actions">
          <button class="btn" type="submit">Sign in as Member</button>
        </div>
        <p class="form-message" id="memberMsg"></p>
        <div class="small">Try <code>jyo / demo123</code> or <code>mariya / demo123</code>.</div>
      </form>

      <form id="managerLoginForm" class="card glass login-card">
        <h3>Manager Command Center</h3>
        <p class="small">Managers unlock branch-wide intelligence, audit logging, and rapid access to every account book.</p>
        <label>Username
          <input class="input" name="username" id="managerUsername" autocomplete="username" required/>
        </label>
        <label>Password
          <input class="input" name="password" type="password" autocomplete="current-password" required/>
        </label>
        <div class="form-actions">
          <button class="btn" type="submit">Sign in as Manager</button>
        </div>
        <p class="form-message" id="managerMsg"></p>
        <div class="small">Try <code>manager / demo123</code> or <code>kochi_mgr / demo123</code>.</div>
      </form>
    </section>

    <section class="grid three fact-grid" aria-labelledby="factsHeading">
      <div class="card glass fact-card">
        <h3 id="factsHeading">SNDP Yogam at a glance</h3>
        <p class="small">Key context for the cooperative movement that powers the demo dataset.</p>
      </div>
      <div class="card glass fact-card">
        <h4>1903 foundation</h4>
        <p class="small">Sree Narayana Dharma Paripalana Yogam was founded in 1903 at Aruvippuram, Kerala to organise community welfare inspired by Sree Narayana Guru.</p>
      </div>
      <div class="card glass fact-card">
        <h4>Headquarters in Kollam</h4>
        <p class="small">The organisation is headquartered in Kollam, coordinating thousands of local sakhas (units) that run savings groups and social programs.</p>
      </div>
      <div class="card glass fact-card">
        <h4>Guru Devan&rsquo;s motto</h4>
        <p class="small">“One caste, one religion, one God for humankind” continues to guide member inclusion and equitable access to cooperative credit.</p>
      </div>
    </section>

    <section class="grid two" style="margin-top:24px;align-items:start">
      <div class="card glass" id="promptCard">
        <h3>AI prompt — generate 10 demo members &amp; Excel books</h3>
        <p class="small">Copy the text below into ChatGPT-5 or another AI assistant. The response will include ten fictional members, ready-to-commit JSON account books, and base64-encoded Excel files you can decode for direct download.</p>
        <textarea id="aiPrompt" class="prompt-box" rows="12" readonly>
You are ChatGPT-5 acting as a dataset generator for the "SNDP Loan Portal" GitHub Pages demo.

Produce TEN fictional SNDP micro-loan members spread across multiple Kerala branches. For each member:
1. Output a JSON object that matches data/users.json with fields:
   - username (lowercase, unique)
   - role = "member"
   - branch (existing or new chapter id)
   - permissions = ["profile:read","profile:update","accounts:read"]
   - full_name, dob (YYYY-MM-DD), address, phone, email, photo = "data/profile_photos/jyo.svg"
   - account_excel = "data/accounts/&lt;username&gt;_account.json"
   - salt and password_hash for the password "demo123" using SHA-256(salt+password) with random 16-char hex salt.
2. Output a companion JSON file named data/accounts/&lt;username&gt;_account.json with fields {"owner","branch","generated", "account": [ ... ]}.
   - Include 18–24 ledger rows over the last 12 months with columns Date (YYYY-MM-DD), Description, Type (Loan, Repayment, Interest, Fee), Amount (positive for disbursements, negative for repayments), Notes.
3. Create an Excel workbook for each member with a sheet "Account" matching the JSON rows, plus a Balance column that cumulatively sums Amount. Return each workbook as base64 for a binary .xlsx file under a key xlsx_base64 inside the account JSON response.

Respond with:
{
  "users": [ ... ten user objects ... ],
  "accounts": {
     "&lt;username&gt;_account.json": {
        "owner": "...",
        "branch": "...",
        "generated": "ISO timestamp",
        "account": [...rows...],
        "xlsx_base64": "base64 encoded .xlsx file for this member"
     },
     ... nine more ...
  }
}

Use realistic INR figures (₹2,000 – ₹75,000 principal balances). Ensure the final balance matches the running ledger. Keep descriptions short and relevant to SNDP community lending.
        </textarea>
        <div class="form-actions" style="margin-top:12px">
          <button class="btn" type="button" id="copyPromptBtn">Copy prompt</button>
          <button class="btn ghost" type="button" id="downloadSampleWorkbook">Download sample Excel</button>
        </div>
        <p id="promptMsg" class="small"></p>
      </div>

      <div class="card glass">
        <h3>How the demo works</h3>
        <ul class="small feature-list">
          <li>Branch-aware dashboard summarises total loaned, repayments, and outstanding balance for every member.</li>
          <li>Members can export Excel snapshots, fetch monthly PDF statements, and manage receipt attachments locally.</li>
          <li>Authentication is demo-only: salted SHA-256 checks run entirely in the browser with shared passwords.</li>
          <li>All data loads from <code>data/*.json</code>, making the project Git-friendly and easy to extend.</li>
        </ul>
        <div class="card ghost" style="margin-top:12px">
          <div class="small">Need more guidance?</div>
          <a class="btn" href="README.html" style="margin-top:8px">Open the onboarding guide</a>
        </div>
      </div>
    </section>

    <footer>© SNDP Demo • Built for GitHub Pages • Featuring Sree Narayana Guru</footer>
  </main>

  <script>
  async function sha256Hex(str){
    const enc = new TextEncoder().encode(str);
    const buf = await crypto.subtle.digest('SHA-256', enc);
    const bytes = Array.from(new Uint8Array(buf));
    return bytes.map(b => b.toString(16).padStart(2,'0')).join('');
  }
  function recordAudit(entry){
    try{
      const list = JSON.parse(localStorage.getItem('audit_log')||'[]');
      list.push({...entry, ts: new Date().toISOString()});
      while(list.length>500){ list.shift(); }
      localStorage.setItem('audit_log', JSON.stringify(list));
    }catch(err){ console.error('audit log failed', err); }
  }
  function applyPasswordOverride(rec){
    try{
      const override = JSON.parse(localStorage.getItem('override_'+rec.username)||'null');
      if(override && override.password_hash && override.salt){
        return {...rec, salt: override.salt, password_hash: override.password_hash};
      }
    }catch(err){ console.warn('override parse failed', err); }
    return rec;
  }
  async function handleLogin(ev, role){
    ev.preventDefault();
    const form = ev.target;
    const username = form.querySelector('input[name="username"]').value.trim();
    const password = form.querySelector('input[name="password"]').value;
    const msg = form.querySelector('.form-message');
    msg.textContent = 'Checking…';
    try{
      const res = await fetch('data/users.json');
      const db = await res.json();
      let rec = db.users.find(x => x.username === username);
      if(!rec){ msg.textContent = 'User not found'; return; }
      if(role === 'manager' && rec.role !== 'manager'){ msg.textContent = 'Please sign in with manager credentials.'; return; }
      if(role === 'member' && rec.role === 'manager'){ msg.textContent = 'Use the manager login panel.'; return; }
      rec = applyPasswordOverride(rec);
      const hash = await sha256Hex(rec.salt + password);
      if(hash !== rec.password_hash){ msg.textContent = 'Invalid password'; return; }
      localStorage.setItem('sndp_session', JSON.stringify({username: rec.username, role: rec.role, ts: Date.now()}));
      recordAudit({actor: rec.username, action: 'login', branch: rec.branch||null});
      location.href = 'app.html';
    }catch(err){
      console.error(err);
      msg.textContent = 'Unable to load users.json';
    }
  }
  function initLoginPanels(){
    document.getElementById('publicLoginForm').addEventListener('submit', ev => handleLogin(ev, 'member'));
    document.getElementById('managerLoginForm').addEventListener('submit', ev => handleLogin(ev, 'manager'));
  }
  async function downloadSampleWorkbook(){
    try{
      const res = await fetch('data/sample_account_workbook.json');
      if(!res.ok){ throw new Error('Unable to load sample workbook definition'); }
      const payload = await res.json();
      const base64 = payload.base64;
      if(!base64){ throw new Error('No workbook data'); }
      const binary = atob(base64);
      const bytes = new Uint8Array(binary.length);
      for(let i=0;i<binary.length;i++){ bytes[i] = binary.charCodeAt(i); }
      const blob = new Blob([bytes.buffer], {type:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = payload.filename || 'sample_account_book.xlsx';
      a.click();
      URL.revokeObjectURL(a.href);
      document.getElementById('promptMsg').textContent = 'Sample Excel downloaded (built from data/accounts/sample_account.json).';
    }catch(err){
      console.error(err);
      document.getElementById('promptMsg').textContent = 'Unable to download the sample workbook right now.';
    }
  }
  async function copyPrompt(){
    const prompt = document.getElementById('aiPrompt').value;
    try{
      await navigator.clipboard.writeText(prompt);
      document.getElementById('promptMsg').textContent = 'Prompt copied to clipboard.';
    }catch(err){
      console.error(err);
      document.getElementById('promptMsg').textContent = 'Copy failed — please select and copy manually.';
    }
  }
  window.addEventListener('DOMContentLoaded', () => {
    initLoginPanels();
    document.getElementById('copyPromptBtn').addEventListener('click', copyPrompt);
    document.getElementById('downloadSampleWorkbook').addEventListener('click', downloadSampleWorkbook);
  });
  </script>
</body>
</html>
